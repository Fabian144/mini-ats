import{u as j,b as w,c}from"./vendor-query-CUB_NE-9.js";import{u as g,a as q,s as o}from"./index-GMuvxNkA.js";function h(){const{user:y,isAdmin:d,adminViewAccount:l}=g(),{toast:s}=q(),i=j(),a=l?.id??y?.id,n=d&&!l,u=w({queryKey:["jobs",n?"all":a],queryFn:async()=>{let e=o.from("jobs").select("id, user_id, title, company, description, location, employment_type, salary_amount, salary_unit, created_at, updated_at").order("created_at",{ascending:!0}).limit(200);n||(e=e.eq("user_id",a));const{data:r,error:t}=await e;if(t)throw t;return r},enabled:n?d:!!a,staleTime:1e3*60*2,refetchOnMount:"always"}),m=c({mutationFn:async e=>{if(!a)throw new Error("Missing target account for job creation");const{data:r,error:t}=await o.from("jobs").insert({...e,user_id:a}).select().single();if(t)throw t;return r},onSuccess:()=>{i.invalidateQueries({queryKey:["jobs"]}),s({title:"Jobb skapat!"})},onError:e=>{s({title:"Kunde inte skapa jobb",description:e.message,variant:"destructive"})}}),p=c({mutationFn:async({id:e,...r})=>{const{data:t,error:b}=await o.from("jobs").update(r).eq("id",e).select().single();if(b)throw b;return t},onSuccess:()=>{i.invalidateQueries({queryKey:["jobs"]}),s({title:"Jobb uppdaterat!"})},onError:e=>{s({title:"Kunde inte uppdatera jobb",description:e.message,variant:"destructive"})}}),f=c({mutationFn:async e=>{const{error:r}=await o.from("candidates").delete().eq("job_id",e);if(r)throw r;const{error:t}=await o.from("jobs").delete().eq("id",e);if(t)throw t},onSuccess:()=>{i.invalidateQueries({queryKey:["jobs"]}),i.invalidateQueries({queryKey:["candidates"]}),s({title:"Jobb borttaget!"})},onError:e=>{s({title:"Kunde inte ta bort jobb",description:e.message,variant:"destructive"})}});return{jobs:!n&&a?(u.data??[]).filter(e=>e.user_id===a):u.data??[],isLoading:u.isLoading,createJob:m,updateJob:p,deleteJob:f}}export{h as u};
