import{r,j as e}from"./vendor-radix-og3wzDO_.js";import{S as $,a as F,b as B,c as Y,d as I,D as q}from"./select-BBUArvpG.js";import{L as K,M as J,P,u as U}from"./useCandidates-DsFBeWLg.js";import{u as V}from"./useJobs-DcSHqmAS.js";import{I as X}from"./label-Cqlawg_Y.js";import{b as L,d as _}from"./index-QOa0XFRL.js";import{B as O}from"./briefcase-DaCKP-EU.js";import"./vendor-supabase-6c5mf4pY.js";import"./vendor-react-DChhcE8F.js";import"./vendor-query-CUB_NE-9.js";import"./button-DyABUjjI.js";import"./vendor-recharts-qYF2F-lo.js";const Q=L("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);const z=L("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]),G=r.memo(function({candidate:a,onTouchDrop:N,onTouchDragMove:b,onTouchDragEnd:h}){const x=r.useRef(!1),m=r.useRef(null),i=r.useRef(null),p=r.useRef(null),n=r.useRef(null),[o,g]=r.useState(!1),w=r.useRef(null),C=s=>{s.dataTransfer.setData("candidateId",a.id)},k=s=>{b(s.clientX)},R=()=>{h()},f=s=>{const c=s.target;if(x.current=!!c?.closest("a"),x.current)return;const l=s.touches[0];l&&(p.current={x:l.clientX,y:l.clientY},n.current&&window.clearTimeout(n.current),n.current=window.setTimeout(()=>{const y=m.current;if(!y)return;const v=y.getBoundingClientRect(),j=y.cloneNode(!0);j.classList.add("kanban-card--overlay"),j.style.left=`${v.left}px`,j.style.top=`${v.top}px`,j.style.width=`${v.width}px`,j.style.height=`${v.height}px`,document.body.appendChild(j),i.current=j,w.current={x:v.left,y:v.top},g(!0)},160))},T=s=>{if(x.current)return;const c=s.touches[0];if(!c)return;if(!o){const D=p.current;if(!D)return;const A=Math.abs(c.clientX-D.x),E=Math.abs(c.clientY-D.y);(A>10||E>10)&&n.current&&(window.clearTimeout(n.current),n.current=null);return}s.preventDefault();const l=p.current,y=w.current;if(!l||!y||!i.current)return;const v=c.clientX-l.x,j=c.clientY-l.y;i.current.style.transform=`translate3d(${v}px, ${j}px, 0)`,b(c.clientX)},t=s=>{if(x.current){x.current=!1;return}n.current&&(window.clearTimeout(n.current),n.current=null);const c=s.changedTouches[0];c&&(o&&(N(a,c.clientX,c.clientY),g(!1),h()),i.current&&(i.current.remove(),i.current=null,w.current=null))},u=()=>{n.current&&(window.clearTimeout(n.current),n.current=null),g(!1),h(),i.current&&(i.current.remove(),i.current=null,w.current=null)},d=_(a.linkedin_url);return e.jsxs("div",{ref:m,draggable:!0,onDragStart:C,onDrag:k,onDragEnd:R,onTouchStart:f,onTouchMove:T,onTouchEnd:t,onTouchCancel:u,className:`kanban-card animate-fade-in${o?" is-touch-dragging":""}`,children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-2",children:[e.jsx("h4",{className:"font-medium text-foreground",children:a.name}),d&&e.jsx("a",{href:d,target:"_blank",rel:"noopener noreferrer",className:"text-primary hover:text-primary/80 transition-colors",onClick:s=>s.stopPropagation(),children:e.jsx(K,{className:"w-4 h-4"})})]}),a.jobs&&e.jsxs("div",{className:"flex items-center gap-1.5 text-xs text-muted-foreground mb-2",children:[e.jsx(O,{className:"w-3 h-3"}),e.jsx("span",{children:a.jobs.title}),a.jobs.company&&e.jsxs("span",{className:"text-muted-foreground/70",children:["@ ",a.jobs.company]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs text-muted-foreground",children:[a.email&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(J,{className:"w-3 h-3"}),e.jsx("span",{className:"truncate max-w-[120px]",children:a.email})]}),a.phone&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(P,{className:"w-3 h-3"}),e.jsx("span",{children:a.phone})]})]}),a.notes&&e.jsx("p",{className:"mt-2 text-xs text-muted-foreground line-clamp-2 border-t border-border pt-2",children:a.notes})]})}),H={new:"bg-status-new",screening:"bg-status-screening",interview:"bg-status-interview",offer:"bg-status-offer",hired:"bg-status-hired",rejected:"bg-status-rejected"},W=r.memo(function({status:a,label:N,candidates:b,onStatusChange:h,onTouchDrop:x,onTouchDragMove:m,onTouchDragEnd:i}){const p=o=>{o.preventDefault(),m(o.clientX)},n=o=>{o.preventDefault();const g=o.dataTransfer.getData("candidateId");g&&h(g,a),i()};return e.jsxs("div",{className:"kanban-column w-72 flex-shrink-0","data-kanban-status":a,onDragOver:p,onDrop:n,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("div",{className:`w-3 h-3 rounded-full ${H[a]}`}),e.jsx("h3",{className:"font-semibold text-foreground",children:N}),e.jsx("span",{className:"ml-auto text-sm text-muted-foreground bg-secondary px-2 py-0.5 rounded-full",children:b.length})]}),e.jsxs("div",{className:"space-y-3",children:[b.map(o=>e.jsx(G,{candidate:o,onTouchDrop:x,onTouchDragMove:m,onTouchDragEnd:i},o.id)),b.length===0&&e.jsx("div",{className:"text-center py-8 text-muted-foreground text-sm",children:"Inga kandidater"})]})]})}),M=[{key:"new",label:"Ny"},{key:"screening",label:"Screening"},{key:"interview",label:"Intervju"},{key:"offer",label:"Erbjudande"},{key:"hired",label:"Anställd"},{key:"rejected",label:"Avslag"}];function Z(){const{candidates:S,isLoading:a,updateCandidate:N}=U(),{jobs:b}=V(),[h,x]=r.useState(""),[m,i]=r.useState("all"),p=r.useRef(null),n=r.useRef(null),o=r.useRef(0),g=r.useMemo(()=>{const t=h.toLowerCase();return S.filter(u=>{const d=u.name.toLowerCase().includes(t),s=m==="all"||u.job_id===m;return d&&s})},[S,h,m]),w=r.useMemo(()=>{const t=new Map;for(const u of M)t.set(u.key,[]);for(const u of g)t.get(u.status)?.push(u);return t},[g]),C=r.useMemo(()=>new Set(M.map(t=>t.key)),[]),k=r.useCallback((t,u)=>{N.mutate({id:t,status:u})},[N]),R=r.useCallback((t,u,d)=>{const l=document.elementFromPoint(u,d)?.closest("[data-kanban-status]")?.dataset.kanbanStatus;!l||!C.has(l)||l===t.status||k(t.id,l)},[k,C]),f=r.useCallback(()=>{n.current!==null&&(cancelAnimationFrame(n.current),n.current=null),o.current=0},[]),T=r.useCallback(t=>{const u=p.current;if(!u)return;const d=u.getBoundingClientRect();if(t===0&&d.left===0){f();return}if(t<d.left||t>d.right){f();return}const s=96;let c=0;if(t<d.left+s){const l=d.left+s-t;c=-Math.min(10,Math.max(4,l/3))}else if(t>d.right-s){const l=t-(d.right-s);c=Math.min(10,Math.max(4,l/3))}if(o.current=c,c===0){f();return}if(n.current===null){const l=()=>{const y=p.current;if(!y||o.current===0){f();return}y.scrollLeft+=o.current,n.current=requestAnimationFrame(l)};n.current=requestAnimationFrame(l)}},[f]);return r.useEffect(()=>()=>f(),[f]),a?e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-pulse text-muted-foreground",children:"Laddar..."})}):e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"flex gap-4 mb-6 flex-wrap",children:[e.jsxs("div",{className:"relative flex-1 min-w-[200px] max-w-sm",children:[e.jsx(z,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(X,{placeholder:"Sök kandidat...",value:h,onChange:t=>x(t.target.value),className:"pl-10"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-4 h-4 text-muted-foreground"}),e.jsxs($,{value:m,onValueChange:i,children:[e.jsx(F,{className:"w-[200px]",children:e.jsx(B,{placeholder:"Filtrera på jobb"})}),e.jsxs(Y,{children:[e.jsx(I,{value:"all",children:"Alla jobb"}),b.map(t=>e.jsx(I,{value:t.id,children:t.title},t.id))]})]})]})]}),e.jsx("div",{ref:p,className:"flex-1 overflow-x-auto",children:e.jsx("div",{className:"flex gap-4 min-w-max pb-4",children:M.map(t=>e.jsx(W,{status:t.key,label:t.label,candidates:w.get(t.key)??[],onStatusChange:k,onTouchDrop:R,onTouchDragMove:T,onTouchDragEnd:f},t.key))})})]})}function me(){return e.jsx(q,{children:e.jsxs("div",{className:"p-6 h-screen flex flex-col",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Rekryteringsöversikt"}),e.jsx("p",{className:"text-muted-foreground",children:"Dra och släpp kandidater för att ändra status"})]}),e.jsx("div",{className:"flex-1",children:e.jsx(Z,{})})]})})}export{me as default};
