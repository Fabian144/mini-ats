import{r as n,j as e}from"./vendor-radix-og3wzDO_.js";import{u as T,a as _,s as B}from"./index-QOa0XFRL.js";import{B as c}from"./button-DyABUjjI.js";import{U as D,L as x,I as f}from"./label-Cqlawg_Y.js";import{C as g,a as j,b as w,c as v,d as N}from"./card-BmOqFtM6.js";import{b as E}from"./vendor-react-DChhcE8F.js";import"./vendor-supabase-6c5mf4pY.js";import"./vendor-recharts-qYF2F-lo.js";import"./vendor-query-CUB_NE-9.js";function $(){const[t,y]=n.useState(""),[d,b]=n.useState(""),[m,h]=n.useState(!1),{updatePassword:k,user:P,loading:C,signOut:L}=T(),i=E(),{toast:a}=_(),u=Number.parseInt(sessionStorage.getItem("route_history_count")??"1",10),p=new URL(window.location.href),l=p.searchParams,o=new URLSearchParams(p.hash.replace(/^#/,"")),S=l.has("error")||l.has("error_code")||l.has("error_description")||o.has("error")||o.has("error_code")||o.has("error_description");if(n.useEffect(()=>{B.auth.getSession()},[]),C)return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:e.jsx("div",{className:"animate-pulse text-muted-foreground",children:"Laddar..."})});if(Number.isNaN(u)||u>1||S||!P)return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsx("div",{className:"w-full max-w-md animate-fade-in",children:e.jsxs(g,{className:"glass-card",children:[e.jsxs(j,{className:"text-center pb-2",children:[e.jsx(w,{children:"Ogiltig återställningslänk"}),e.jsx(v,{children:"Länken verkar vara för gammal eller redan använd. Be om en ny återställningslänk och prova igen."})]}),e.jsx(N,{children:e.jsx(c,{className:"w-full",onClick:()=>i("/auth"),children:"Tillbaka till inloggning"})})]})})});const U=()=>{const s=new URL(window.location.href),r=new URLSearchParams(s.search);s.hash="",r.get("type")==="recovery"&&(r.delete("type"),s.search=r.toString()?`?${r.toString()}`:""),window.history.replaceState({},"",s.toString())},R=async s=>{if(s.preventDefault(),t.length<6){a({title:"Lösenordet är för kort",description:"Välj ett lösenord med minst 6 tecken.",variant:"destructive"});return}if(t!==d){a({title:"Lösenorden matchar inte",description:"Kontrollera att båda fälten har samma lösenord.",variant:"destructive"});return}h(!0);const{error:r}=await k(t);r?a({title:"Kunde inte uppdatera lösenord",description:r.message,variant:"destructive"}):(a({title:"Lösenord uppdaterat",description:"Du kan nu logga in med ditt nya lösenord."}),U(),i("/auth")),h(!1)};return e.jsx("div",{className:"min-h-screen bg-background flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md animate-fade-in",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-2xl bg-primary/10 mb-4",children:e.jsx(D,{className:"w-8 h-8 text-primary"})}),e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"TalentTrack"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Ditt smarta rekryteringsverktyg"})]}),e.jsxs(g,{className:"glass-card",children:[e.jsxs(j,{className:"text-center pb-2",children:[e.jsx(w,{children:"Återställ lösenord"}),e.jsx(v,{children:"Välj ett nytt lösenord för ditt konto."})]}),e.jsx(N,{children:e.jsxs("form",{onSubmit:R,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(x,{htmlFor:"new-password",children:["Nytt lösenord ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(f,{id:"new-password",type:"password",placeholder:"Minst 6 tecken",value:t,onChange:s=>y(s.target.value),required:!0,minLength:6})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(x,{htmlFor:"confirm-password",children:["Bekräfta lösenord ",e.jsx("span",{className:"text-destructive",children:"*"})]}),e.jsx(f,{id:"confirm-password",type:"password",placeholder:"Upprepa lösenordet",value:d,onChange:s=>b(s.target.value),required:!0,minLength:6})]}),e.jsx(c,{type:"submit",className:"w-full",disabled:m,children:m?"Uppdaterar...":"Uppdatera lösenord"}),e.jsx(c,{type:"button",variant:"link",className:"px-0",onClick:async()=>{await L(),i("/auth")},children:"Tillbaka till inloggning"})]})})]})]})})}export{$ as default};
